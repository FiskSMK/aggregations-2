from pymongo import MongoClient

client = MongoClient()
db = client.rita
coll = db.flights

# for flight in coll.find():
#     try:
#         flight["PLANE"]["YEAR MFR"] = int(flight["PLANE"]["YEAR MFR"])
#         coll.update({"_id": flight["_id"]}, flight)
#     except:
#         coll.remove({"_id": flight["_id"]})

flights_delayed = {}
flights_delayed_time = {}
for flight in coll.find({"PLANE.YEAR MFR": {"$gt": 0}, "DEP_DELAY": {"$gt": 10}}):
    try:
        flights_delayed[flight["PLANE"]["YEAR MFR"]] += 1 
        flights_delayed_time[flight["PLANE"]["YEAR MFR"]] += flight["DEP_DELAY"]
    except KeyError:
        flights_delayed[flight["PLANE"]["YEAR MFR"]] = 1
        flights_delayed_time[flight["PLANE"]["YEAR MFR"]] = flight["DEP_DELAY"]
    
from pprint import pprint
pprint(flights_delayed)
pprint(flights_delayed_time)


flights_avg_delay = {}
for k in flights_delayed.keys():
    flights_avg_delay[k] = float(flights_delayed_time[k])/flights_delayed[k]

print "*"*10
pprint(flights_avg_delay)

# {1956: 13,
#  1959: 160,
#  1963: 91,
#  1965: 17,
#  1967: 38,
#  1968: 94,
#  1971: 86,
#  1972: 18,
#  1973: 10,
#  1974: 114,
#  1975: 196,
#  1976: 327,
#  1977: 205,
#  1978: 219,
#  1979: 446,
#  1980: 473,
#  1982: 8,
#  1983: 136,
#  1984: 235,
#  1985: 1548,
#  1986: 935,
#  1987: 2400,
#  1988: 4756,
#  1989: 3511,
#  1990: 4432,
#  1991: 6607,
#  1992: 5778,
#  1993: 3900,
#  1994: 4128,
#  1995: 5114,
#  1996: 6254,
#  1997: 7389,
#  1998: 14030,
#  1999: 16078,
#  2000: 17704,
#  2001: 23002,
#  2002: 21135,
#  2003: 18901,
#  2004: 19049,
#  2005: 15842,
#  2006: 12682,
#  2007: 9489,
#  2008: 10113,
#  2009: 6508,
#  2010: 3345,
#  2011: 4655,
#  2012: 5890,
#  2013: 467}
#  
#  
# {1956: 481,
#  1959: 7937,
#  1963: 4701,
#  1965: 579,
#  1967: 2176,
#  1968: 6444,
#  1971: 4259,
#  1972: 884,
#  1973: 476,
#  1974: 5994,
#  1975: 8572,
#  1976: 20494,
#  1977: 11161,
#  1978: 10366,
#  1979: 24186,
#  1980: 25879,
#  1982: 135,
#  1983: 9560,
#  1984: 13922,
#  1985: 61274,
#  1986: 43129,
#  1987: 113097,
#  1988: 213139,
#  1989: 161660,
#  1990: 213951,
#  1991: 322519,
#  1992: 266164,
#  1993: 172537,
#  1994: 173874,
#  1995: 223672,
#  1996: 280446,
#  1997: 370826,
#  1998: 701611,
#  1999: 793039,
#  2000: 856100,
#  2001: 1173333,
#  2002: 1152329,
#  2003: 1011258,
#  2004: 943362,
#  2005: 791482,
#  2006: 604219,
#  2007: 436778,
#  2008: 491830,
#  2009: 300943,
#  2010: 146724,
#  2011: 213885,
#  2012: 220318,
#  2013: 17703}

# **********
# {1956: 37.0,
#  1959: 49.60625,
#  1963: 51.65934065934066,
#  1965: 34.05882352941177,
#  1967: 57.26315789473684,
#  1968: 68.55319148936171,
#  1971: 49.52325581395349,
#  1972: 49.111111111111114,
#  1973: 47.6,
#  1974: 52.578947368421055,
#  1975: 43.734693877551024,
#  1976: 62.67278287461774,
#  1977: 54.44390243902439,
#  1978: 47.333333333333336,
#  1979: 54.228699551569505,
#  1980: 54.71247357293869,
#  1982: 16.875,
#  1983: 70.29411764705883,
#  1984: 59.242553191489364,
#  1985: 39.582687338501295,
#  1986: 46.127272727272725,
#  1987: 47.12375,
#  1988: 44.81476030277544,
#  1989: 46.043862147536316,
#  1990: 48.27414259927798,
#  1991: 48.814741940366275,
#  1992: 46.06507442021461,
#  1993: 44.24025641025641,
#  1994: 42.12063953488372,
#  1995: 43.73719202190067,
#  1996: 44.842660697153825,
#  1997: 50.186222763567464,
#  1998: 50.00791161796151,
#  1999: 49.32448065679811,
#  2000: 48.35630366018979,
#  2001: 51.01004260499087,
#  2002: 54.52230896616986,
#  2003: 53.50288344532035,
#  2004: 49.522914588692316,
#  2005: 49.96098977401843,
#  2006: 47.64382589496925,
#  2007: 46.029929391927496,
#  2008: 48.63344210422229,
#  2009: 46.2420098340504,
#  2010: 43.86367713004484,
#  2011: 45.94736842105263,
#  2012: 37.405432937181665,
#  2013: 37.90792291220557}